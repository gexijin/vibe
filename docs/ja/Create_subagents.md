[ホーム](./ja/)

# Claude Codeでサブエージェントを作成

投資機会を比較したいが、複数の企業を調査してスコアリングするには何時間もかかります。サブエージェントを、あなたの研究ツールの使い方を正確に知っている金融アナリストを雇うようなものと考えてください—企業名を伝えると、レポートを収集し、主要な指標で各企業をスコアリングし、最適な投資を推奨します。サブエージェントの構築方法を学べば、仕事で繰り返し発生する複数ステップのワークフローを自動化できます。このチュートリアルでは、そのアナリストを構築する方法を示します。

## 主要な概念

- **サブエージェント** - 独自の目標、システムプロンプト、ツールを持ち、自律的にタスクを完了する専門的なAIワーカー
- **スキル** - サブエージェントが目標を達成するために呼び出すことができる再利用可能な機能（株式レポートの生成など）
- **システムプロンプト** - サブエージェントが何をするか、企業をどのようにスコアリングするか、どの形式で返すかを定義する指示
- **関心の分離** - スキルはデータを収集し、サブエージェントはそのデータを使用して意思決定を行う

## 必要なもの

- [WindowsでVS CodeでClaude Code](./Claude_Code_in_VS_Code_Win.md)または[MacでVS CodeでClaude Code](./Claude_Code_in_VS_Code_Mac.md)を完了していること
- 株式レポートスキルがすでにインストールされていること（`.claude/skills/generate-stock-reports/`内）
- VS Codeまたは別のテキストエディタ
- 20〜25分

## ステップ1：プロジェクトフォルダを作成してClaude Codeを起動

**Windows（WSL）：**
- スタートメニューから**Ubuntu**を開く
- 次のコマンドを入力：
  ```bash
  cd /mnt/c/Users/YOUR_USERNAME/Documents
  mkdir stock_picker_test
  cd stock_picker_test
  ```
  `YOUR_USERNAME`をWindowsのユーザー名に置き換えてください
- Claude Codeを起動：
  ```
  claude
  ```

**Mac：**
- **ターミナル**を開く（アプリケーション > ユーティリティにあります）
- 次のコマンドを入力：
  ```bash
  cd ~/Documents
  mkdir stock_picker_test
  cd stock_picker_test
  ```
- Claude Codeを起動：
  ```
  claude
  ```

Claude Codeが起動し、ウェルカムメッセージが表示されます。

## ステップ2：株式レポートスキルの存在を確認

サブエージェントを構築する前に、スキルが利用可能であることを確認します。次を入力：

```
利用可能なすべてのスキルをリストしてください
```

出力に`generate-stock-reports`が表示されるはずです。このスキルは企業を調査し、製品ニュース、経営陣の更新、財務実績、アナリストの洞察をカバーするレポートを生成します。

表示されない場合、スキルファイルは`.claude/skills/generate-stock-reports/`（プロジェクトレベル）にあるはずです。

## ステップ3：サブエージェント vs スキルのアーキテクチャを理解

サブエージェントとスキルがどのように連携するかは次のとおりです：

| コンポーネント | 目的 | 例 |
|-----------|---------|---------|
| **スキル** | 1つの企業に関する生データを収集 | 「Appleのレポートを生成：製品、財務、経営陣、アナリスト」 |
| **サブエージェント** | スキルデータを使用して目標を達成 | 「AppleとMicrosoftのレポートを取得し、両方をスコアリングし、どちらに投資すべきか推奨」 |

**主な違い：**
- **スキル = ツール** 研究を行う
- **サブエージェント = 意思決定者** ツールを使用してロジックを適用する

あなたの株式選択サブエージェントは：
1. 各企業のために株式レポートスキルを呼び出す（2回以上）
2. カテゴリ全体で企業をスコアリング（財務、成長、経営陣、センチメント）
3. スコアを比較して最適な投資を推奨

## ステップ4：株式選択サブエージェントを作成

次のコマンドを入力：

```
/agents
```

Claude Codeエージェントインターフェースが表示され、既存のサブエージェント（ある場合）と、サブエージェントを**作成**、**編集**、**削除**するオプションが表示されます。

サブエージェントを作成しましょう：
- **Create new subagent**を選択
- **Project**を選択
- **Generate with Claude (recommended)**を選択
- 指示として次を貼り付け：
  ```
  stock-pickerという新しいサブエージェント用のmarkdownファイルを作成してください：
  - 2つ以上の株式を受け取る
  - generate-stock-reportsスキルを使用して調査を行う
  - 収集されたデータのカテゴリに基づいてスコアカードを作成
  - 最終的な推奨事項を提供
  ```
- **[Continue]**で**Enter**を押して**All tools**を使用
- モデルに**Sonnet**を選択
- **Enter**を押してランダムに色を選択

## ステップ5：構築したものを確認（リフレクションチェックポイント）

VS Codeでファイルを開くには、**ファイル > ファイルを開く...**をクリックして`.claude/agents/stock-picker.md`に移動します。

または、Claudeに依頼できます：
```
stock-pickerサブエージェントファイルを表示してください。
```
Claudeが`.claude/agents/stock-picker.md`にあるサブエージェントファイルを表示します。次のことがわかります：

上部に**YAMLフロントマター**があります：
```
---
name: stock-picker
description: 投資判断のために複数の企業を比較...
skills: generate-stock-reports
---
```

このフロントマター（`---`マーカー間のセクション）は、このサブエージェントをいつアクティブ化するか、どのスキルを使用できるかをClaude Codeに伝えます。

フロントマターの下にスコアリング方法論を含む**システムプロンプト**があります。

**これらの主要な要素を確認：**
- サブエージェントが`generate-stock-reports`スキルにアクセスできる
- システムプロンプトがスコアリングの内訳を説明している
- サブエージェントの目標が明確：企業を比較して1つを推奨

ファイルを直接編集することも、Claudeに更新を依頼することもできます。

## ステップ6：サブエージェントをテスト

実際の比較でサブエージェントをテストしましょう。次を入力：

```
AppleとGoogleではどちらが良い投資ですか？
```

サブエージェントは説明に基づいて自動的にアクティブ化されます。

## ステップ7：サブエージェントの動作を観察

サブエージェントが実行されると、次のことが表示されます：
1. **スキルを2回呼び出す** - Appleに対して1回、Googleに対して1回、generate-stock-reportsスキルを呼び出す
2. **データを収集** - 各スキル呼び出しがウェブを検索して企業レポートを生成
3. **企業をスコアリング** - カテゴリ全体で40/30/20/10の重み付けを適用
4. **出力を生成** - 比較表と推奨事項を作成

ウェブリサーチが含まれるため、これには2〜3分かかる場合があります。

## ステップ8：出力を確認

サブエージェントは次のような詳細な分析を返します：
- **個別の企業レポート** - 各株式の製品更新、財務指標、経営陣の変更、アナリストのセンチメント
- **比較スコアカード** - カテゴリ全体での数値スコア（財務健全性、成長可能性、経営品質、市場センチメント）
- **最終推奨事項** - どの株式に投資すべきか、その理由

サブエージェントは、これをターミナルに表示するか、完全なレポートを含むmarkdownファイルを生成する場合があります。スコアリングの重みや出力形式をカスタマイズするには、サブエージェントファイルを編集できます。

## 次のステップ

動作する株式選択サブエージェントができたので、これらの拡張を試してみてください：

- **3つ以上の株式を比較**：「AAPL、MSFT、GOOGLを比較」して、サブエージェントがより多くのオプションをどのように処理するかを確認
- **スコアリングの重みを調整**：サブエージェントファイルを編集して40/30/20/10の内訳を変更（例：成長株を好む場合は成長を40%にする）
- **他のサブエージェントを作成**：さまざまなタスク用に「code-reviewer」サブエージェント、「bug-hunter」サブエージェント、「document-writer」サブエージェントを構築

## トラブルシューティング

- **サブエージェントがアクティブ化されない**：リクエストが企業の比較や投資判断について言及していることを確認してください。試してみてください：「stock-pickerサブエージェントを使用して比較...」
- **スキルが見つからない**：`.claude/skills/generate-stock-reports/SKILL.md`が存在することを確認してください。追加したばかりの場合は、Claude Codeを再起動してください。
- **スコアが不完全**：サブエージェントに「続けて」または「各カテゴリのスコアを詳しく説明して」と依頼します
- **サブエージェント作成エラー**：`.claude/agents/`フォルダが存在することを確認してください。Claude Codeが自動的に作成するはずです。

## ワークフロー概要

- **サブエージェントは複数ステップのワークフローを自動化** - スキルを調整し、ロジックを適用し、意思決定を提供
- **スキルは再利用可能なツール** - 1つのスキルを複数のサブエージェントがさまざまな目標のために使用できる
- **システムプロンプトが動作を定義** - 明確な指示とスコアリング基準により、サブエージェントを信頼できるものにする
- **サブエージェントはフォーカスを維持** - 各サブエージェントには、明確な単一の目的（株式選択、コードレビューなど）がある
- **構成がスケールする** - 連携するスキルとサブエージェントのライブラリを構築

---

[Steven Ge](https://www.linkedin.com/in/steven-ge-ab016947/)が2025年12月14日に作成。
